/*
* Pusher JavaScript Library v1.12.2
* http://pusherapp.com/
*
* Copyright 2011, Pusher
* Released under the MIT licence.
*/
(function(){if(Function.prototype.scopedTo===void 0)Function.prototype.scopedTo=function(a,b){var c=this;return function(){return c.apply(a,Array.prototype.slice.call(b||[]).concat(Array.prototype.slice.call(arguments)))}};var a=function(c,d){this.options=d||{};this.key=c;this.channels=new a.Channels;this.global_emitter=new a.EventsDispatcher;var b=this;this.checkAppKey();this.connection=new a.Connection(this.key,this.options);this.connection.bind("connected",function(){b.subscribeAll()}).bind("message",function(a){var d=a.event.indexOf("pusher_internal:")===0;if(a.channel){var c;(c=b.channel(a.channel))&&c.emit(a.event,a.data)}d||b.global_emitter.emit(a.event,a.data)}).bind("disconnected",function(){b.channels.disconnect()}).bind("error",function(b){a.warn("Error",b)});a.instances.push(this);a.isReady&&b.connect()};a.instances=[];a.prototype={channel:function(a){return this.channels.find(a)},connect:function(){this.connection.connect()},disconnect:function(){this.connection.disconnect()},bind:function(a,b){this.global_emitter.bind(a,b);return this},bind_all:function(a){this.global_emitter.bind_all(a);return this},subscribeAll:function(){for(channelName in this.channels.channels)this.channels.channels.hasOwnProperty(channelName)&&this.subscribe(channelName)},subscribe:function(b){var c=this,a=this.channels.add(b,this);this.connection.state==="connected"&&a.authorize(this.connection.socket_id,this.options,function(e,d){e?a.emit("pusher:subscription_error",d):c.send_event("pusher:subscribe",{channel:b,auth:d.auth,channel_data:d.channel_data})});return a},unsubscribe:function(a){this.channels.remove(a);this.connection.state==="connected"&&this.send_event("pusher:unsubscribe",{channel:a})},send_event:function(a,b,c){return this.connection.send_event(a,b,c)},checkAppKey:function(){(this.key===null||this.key===void 0)&&a.warn("Warning","You must pass your app key when you instantiate Pusher.")}};a.Util={extend:function b(d,c){for(var a in c)d[a]=c[a]&&c[a].constructor&&c[a].constructor===Object?b(d[a]||{},c[a]):c[a];return d},stringify:function(){for(var b=["Pusher"],a=0;a<arguments.length;a++)typeof arguments[a]==="string"?b.push(arguments[a]):window.JSON==void 0?b.push(arguments[a].toString()):b.push(JSON.stringify(arguments[a]));return b.join(" : ")},arrayIndexOf:function(a,c){var b=Array.prototype.indexOf;if(a==null)return-1;if(b&&a.indexOf===b)return a.indexOf(c);for(i=0,l=a.length;i<l;i++)if(a[i]===c)return i;return-1}};a.debug=function(){a.log&&a.log(a.Util.stringify.apply(this,arguments))};a.warn=function(){window.console&&window.console.warn?window.console.warn(a.Util.stringify.apply(this,arguments)):a.log&&a.log(a.Util.stringify.apply(this,arguments))};a.VERSION="1.12.2";a.host="ws.pusherapp.com";a.ws_port=80;a.wss_port=443;a.channel_auth_endpoint="/pusher/auth";a.cdn_http="http://js.pusher.com/";a.cdn_https="https://d3dy5gmtp8yhk7.cloudfront.net/";a.dependency_suffix=".min";a.channel_auth_transport="ajax";a.activity_timeout=1.2e5;a.pong_timeout=3e4;a.isReady=!1;a.ready=function(){a.isReady=!0;for(var b=0,c=a.instances.length;b<c;b++)a.instances[b].connect()};this.Pusher=a}).call(this);(function(){function b(){this._callbacks={}}function a(a){this.callbacks=new b;this.global_callbacks=[];this.failThrough=a}b.prototype.get=function(a){return this._callbacks[this._prefix(a)]};b.prototype.add=function(c,b){var a=this._prefix(c);this._callbacks[a]=this._callbacks[a]||[];this._callbacks[a].push(b)};b.prototype.remove=function(a,b){if(this.get(a)){var c=Pusher.Util.arrayIndexOf(this.get(a),b);this._callbacks[this._prefix(a)].splice(c,1)}};b.prototype._prefix=function(a){return"_"+a};a.prototype.bind=function(b,a){this.callbacks.add(b,a);return this};a.prototype.unbind=function(b,a){this.callbacks.remove(b,a);return this};a.prototype.emit=function(c,b){for(var a=0;a<this.global_callbacks.length;a++)this.global_callbacks[a](c,b);var d=this.callbacks.get(c);if(d)for(a=0;a<d.length;a++)d[a](b);else this.failThrough&&this.failThrough(c,b);return this};a.prototype.bind_all=function(a){this.global_callbacks.push(a);return this};this.Pusher.EventsDispatcher=a}).call(this);(function(){function c(b,a,c){a[b]!==void 0&&a[b](c)}function a(a,c,d){b.EventsDispatcher.call(this);this.state=void 0;this.errors=[];this.stateActions=d;this.transitions=c;this.transition(a)}var b=this.Pusher;a.prototype.transition=function(a,e){var d=this.state,f=this.stateActions;if(d&&b.Util.arrayIndexOf(this.transitions[d],a)==-1)throw this.emit("invalid_transition_attempt",{oldState:d,newState:a}),Error("Invalid transition ["+d+" to "+a+"]");c(d+"Exit",f,e);c(d+"To"+(a.substr(0,1).toUpperCase()+a.substr(1)),f,e);c(a+"Pre",f,e);this.state=a;this.emit("state_change",{oldState:d,newState:a});c(a+"Post",f,e)};a.prototype.is=function(a){return this.state===a};a.prototype.isNot=function(a){return this.state!==a};b.Util.extend(a.prototype,b.EventsDispatcher.prototype);this.Pusher.Machine=a}).call(this);(function(){var a=function(){var a=this;Pusher.EventsDispatcher.call(this);window.addEventListener!==void 0&&(window.addEventListener("online",function(){a.emit("online",null)},!1),window.addEventListener("offline",function(){a.emit("offline",null)},!1))};a.prototype.isOnLine=function(){return window.navigator.onLine===void 0?!0:window.navigator.onLine};Pusher.Util.extend(a.prototype,Pusher.EventsDispatcher.prototype);this.Pusher.NetInfo=a}).call(this);(function(){function c(b){b.connectionWait=0;b.openTimeout=a.TransportType==="flash"?5e3:2e3;b.connectedTimeout=2e3;b.connectionSecure=b.compulsorySecure;b.connectionAttempts=0}function b(r,s){function l(){b.connectionWait<h&&(b.connectionWait+=e);b.openTimeout<i&&(b.openTimeout+=d);b.connectedTimeout<j&&(b.connectedTimeout+=f);if(b.compulsorySecure!==!0)b.connectionSecure=!b.connectionSecure;b.connectionAttempts++}function m(){b._machine.transition("impermanentlyClosing")}function p(){b._activityTimer&&clearTimeout(b._activityTimer);b._activityTimer=setTimeout(function(){b.send_event("pusher:ping",{});b._activityTimer=setTimeout(function(){b.socket.close()},b.options.pong_timeout||a.pong_timeout)},b.options.activity_timeout||a.activity_timeout)}function t(){var a=b.connectionWait;if(a===0&&b.connectedAt){var c=(new Date).getTime()-b.connectedAt;c<1e3&&(a=1e3-c)}return a}function u(){b._machine.transition("open")}function v(a){a=q(a);if(a!==void 0)if(a.event==="pusher:connection_established")b._machine.transition("connected",a.data.socket_id);else if(a.event==="pusher:error"){var c=a.data.code;b.emit("error",{type:"PusherError",data:{code:c,message:a.data.message}});c===4e3?(b.compulsorySecure=!0,b.connectionSecure=!0,b.options.encrypted=!0,m()):c<4100?b._machine.transition("permanentlyClosing"):c<4200?(b.connectionWait=1e3,b._machine.transition("waiting")):c<4300?m():b._machine.transition("permanentlyClosing")}}function w(c){p();c=q(c);if(c!==void 0){a.debug("Event recd",c);switch(c.event){case"pusher:error":b.emit("error",{type:"PusherError",data:c.data});break;case"pusher:ping":b.send_event("pusher:pong",{})}b.emit("message",c)}}function q(c){try{var a=JSON.parse(c.data);if(typeof a.data==="string")try{a.data=JSON.parse(a.data)}catch(d){if(!(d instanceof SyntaxError))throw d;}return a}catch(e){b.emit("error",{type:"MessageParseError",error:e,data:c.data})}}function n(){b._machine.transition("waiting")}function o(a){b.emit("error",{type:"WebSocketError",error:a})}function k(c,e){var d=b.state;b.state=c;d!==c&&(a.debug("State changed",d+" -> "+c),b.emit("state_change",{previous:d,current:c}),b.emit(c,e))}var b=this;a.EventsDispatcher.call(this);this.options=a.Util.extend({encrypted:!1},s);this.netInfo=new a.NetInfo;this.netInfo.bind("online",function(){b._machine.is("waiting")&&(b._machine.transition("connecting"),k("connecting"))});this.netInfo.bind("offline",function(){if(b._machine.is("connected"))b.socket.onclose=void 0,b.socket.onmessage=void 0,b.socket.onerror=void 0,b.socket.onopen=void 0,b.socket.close(),b.socket=void 0,b._machine.transition("waiting")});this._machine=new a.Machine("initialized",g,{initializedPre:function(){b.compulsorySecure=b.options.encrypted;b.key=r;b.socket=null;b.socket_id=null;b.state="initialized"},waitingPre:function(){b.connectionWait>0&&b.emit("connecting_in",b.connectionWait);b.netInfo.isOnLine()&&b.connectionAttempts<=4?k("connecting"):k("unavailable");if(b.netInfo.isOnLine())b._waitingTimer=setTimeout(function(){b._machine.transition("connecting")},t())},waitingExit:function(){clearTimeout(b._waitingTimer)},connectingPre:function(){if(b.netInfo.isOnLine()===!1)b._machine.transition("waiting"),k("unavailable");else{var c;c=a.ws_port;var d="ws://";if(b.connectionSecure||document.location.protocol==="https:")c=a.wss_port,d="wss://";c=d+a.host+":"+c+"/app/"+b.key+"?protocol=5&client=js&version="+a.VERSION+"&flash="+(a.TransportType==="flash"?"true":"false");a.debug("Connecting",c);b.socket=new a.Transport(c);b.socket.onopen=u;b.socket.onclose=n;b.socket.onerror=o;b._connectingTimer=setTimeout(m,b.openTimeout)}},connectingExit:function(){clearTimeout(b._connectingTimer);b.socket.onopen=void 0},connectingToWaiting:function(){l()},connectingToImpermanentlyClosing:function(){l()},openPre:function(){b.socket.onmessage=v;b.socket.onerror=o;b.socket.onclose=n;b._openTimer=setTimeout(m,b.connectedTimeout)},openExit:function(){clearTimeout(b._openTimer);b.socket.onmessage=void 0},openToWaiting:function(){l()},openToImpermanentlyClosing:function(){l()},connectedPre:function(a){b.socket_id=a;b.socket.onmessage=w;b.socket.onerror=o;b.socket.onclose=n;c(b);b.connectedAt=(new Date).getTime();p()},connectedPost:function(){k("connected")},connectedExit:function(){b._activityTimer&&clearTimeout(b._activityTimer);k("disconnected")},impermanentlyClosingPost:function(){if(b.socket)b.socket.onclose=n,b.socket.close()},permanentlyClosingPost:function(){b.socket?(b.socket.onclose=function(){c(b);b._machine.transition("permanentlyClosed")},b.socket.close()):(c(b),b._machine.transition("permanentlyClosed"))},failedPre:function(){k("failed");a.debug("WebSockets are not available in this browser.")},permanentlyClosedPost:function(){k("disconnected")}})}var a=this.Pusher,g={initialized:["waiting","failed"],waiting:["connecting","permanentlyClosed"],connecting:["open","permanentlyClosing","impermanentlyClosing","waiting"],open:["connected","permanentlyClosing","impermanentlyClosing","waiting"],connected:["permanentlyClosing","waiting"],impermanentlyClosing:["waiting","permanentlyClosing"],permanentlyClosing:["permanentlyClosed"],permanentlyClosed:["waiting","failed"],failed:["permanentlyClosed"]},e=2e3,d=2e3,f=2e3,h=5*e,i=5*d,j=5*f;b.prototype.connect=function(){!this._machine.is("failed")&&!a.Transport?this._machine.transition("failed"):this._machine.is("initialized")?(c(this),this._machine.transition("waiting")):this._machine.is("waiting")&&this.netInfo.isOnLine()===!0?this._machine.transition("connecting"):this._machine.is("permanentlyClosed")&&(c(this),this._machine.transition("waiting"))};b.prototype.send=function(a){if(this._machine.is("connected")){var b=this;setTimeout(function(){b.socket.send(a)},0);return!0}else return!1};b.prototype.send_event=function(b,d,c){b={event:b,data:d};c&&(b.channel=c);a.debug("Event sent",b);return this.send(JSON.stringify(b))};b.prototype.disconnect=function(){this._machine.is("permanentlyClosed")||(this._machine.is("waiting")||this._machine.is("failed")?this._machine.transition("permanentlyClosed"):this._machine.transition("permanentlyClosing"))};a.Util.extend(b.prototype,a.EventsDispatcher.prototype);this.Pusher.Connection=b}).call(this);(function(){Pusher.Channels=function(){this.channels={}};Pusher.Channels.prototype={add:function(b,c){var a=this.find(b);a||(a=Pusher.Channel.factory(b,c),this.channels[b]=a);return a},find:function(a){return this.channels[a]},remove:function(a){delete this.channels[a]},disconnect:function(){for(var a in this.channels)this.channels[a].disconnect()}};Pusher.Channel=function(a,b){var c=this;Pusher.EventsDispatcher.call(this,function(b){Pusher.debug("No callbacks on "+a+" for "+b)});this.pusher=b;this.name=a;this.subscribed=!1;this.bind("pusher_internal:subscription_succeeded",function(a){c.onSubscriptionSucceeded(a)})};Pusher.Channel.prototype={init:function(){},disconnect:function(){this.subscribed=!1;this.emit("pusher_internal:disconnected")},onSubscriptionSucceeded:function(){this.subscribed=!0;this.emit("pusher:subscription_succeeded")},authorize:function(b,c,a){return a(!1,{})},trigger:function(a,b){return this.pusher.send_event(a,b,this.name)}};Pusher.Util.extend(Pusher.Channel.prototype,Pusher.EventsDispatcher.prototype);Pusher.Channel.PrivateChannel={authorize:function(a,b,c){var d=this;return(new Pusher.Channel.Authorizer(this,Pusher.channel_auth_transport,b)).authorize(a,function(a,b){a||d.emit("pusher_internal:authorized",b);c(a,b)})}};Pusher.Channel.PresenceChannel={init:function(){this.members=new a(this)},onSubscriptionSucceeded:function(){this.subscribed=!0}};var a=function(b){var a=this,c=function(){this._members_map={};this.count=0;this.me=null};c.call(this);b.bind("pusher_internal:authorized",function(c){var d=JSON.parse(c.channel_data);b.bind("pusher_internal:subscription_succeeded",function(c){a._members_map=c.presence.hash;a.count=c.presence.count;a.me=a.get(d.user_id);b.emit("pusher:subscription_succeeded",a)})});b.bind("pusher_internal:member_added",function(c){a.get(c.user_id)===null&&a.count++;a._members_map[c.user_id]=c.user_info;b.emit("pusher:member_added",a.get(c.user_id))});b.bind("pusher_internal:member_removed",function(c){var d=a.get(c.user_id);d&&(delete a._members_map[c.user_id],a.count--,b.emit("pusher:member_removed",d))});b.bind("pusher_internal:disconnected",function(){c.call(a)})};a.prototype={each:function(a){for(var b in this._members_map)a(this.get(b))},"get":function(a){return this._members_map.hasOwnProperty(a)?{id:a,info:this._members_map[a]}:null}};Pusher.Channel.factory=function(b,c){var a=new Pusher.Channel(b,c);b.indexOf("private-")===0?Pusher.Util.extend(a,Pusher.Channel.PrivateChannel):b.indexOf("presence-")===0&&(Pusher.Util.extend(a,Pusher.Channel.PrivateChannel),Pusher.Util.extend(a,Pusher.Channel.PresenceChannel));a.init();return a}}).call(this);(function(){Pusher.Channel.Authorizer=function(c,a,b){this.channel=c;this.type=a;this.authOptions=(b||{}).auth||{}};Pusher.Channel.Authorizer.prototype={composeQuery:function(b){var b="&socket_id="+encodeURIComponent(b)+"&channel_name="+encodeURIComponent(this.channel.name),a;for(a in this.authOptions.params)b+="&"+encodeURIComponent(a)+"="+encodeURIComponent(this.authOptions.params[a]);return b},authorize:function(b,a){return Pusher.authorizers[this.type].call(this,b,a)}};Pusher.auth_callbacks={};Pusher.authorizers={ajax:function(d,b){var a;a=Pusher.XHR?new Pusher.XHR:window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.open("POST",Pusher.channel_auth_endpoint,!0);a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var c in this.authOptions.headers)a.setRequestHeader(c,this.authOptions.headers[c]);a.onreadystatechange=function(){if(a.readyState==4)if(a.status==200){var c,d=!1;try{c=JSON.parse(a.responseText),d=!0}catch(e){b(!0,"JSON returned from webapp was invalid, yet status code was 200. Data was: "+a.responseText)}d&&b(!1,c)}else Pusher.warn("Couldn't get auth info from your webapp",a.status),b(!0,a.status)};a.send(this.composeQuery(d));return a},jsonp:function(d,c){this.authOptions.headers!==void 0&&Pusher.warn("Warn","To send headers with the auth request, you must use AJAX, rather than JSONP.");var a=document.createElement("script");Pusher.auth_callbacks[this.channel.name]=function(a){c(!1,a)};a.src=Pusher.channel_auth_endpoint+"?callback="+encodeURIComponent("Pusher.auth_callbacks['"+this.channel.name+"']")+this.composeQuery(d);var b=document.getElementsByTagName("head")[0]||document.documentElement;b.insertBefore(a,b.firstChild)}}}).call(this);var _require=function(){function b(a,b){document.addEventListener?a.addEventListener("load",b,!1):a.attachEvent("onreadystatechange",function(){(a.readyState=="loaded"||a.readyState=="complete")&&b()})}function a(c,d){var e=document.getElementsByTagName("head")[0],a=document.createElement("script");a.setAttribute("src",c);a.setAttribute("type","text/javascript");a.setAttribute("async",!0);b(a,function(){d()});e.appendChild(a)}return function(b,d){for(var e=0,c=0;c<b.length;c++)a(b[c],function(){b.length==++e&&setTimeout(d,0)})}}();(function(){!window.WebSocket&&window.MozWebSocket&&(window.WebSocket=window.MozWebSocket);if(window.WebSocket)Pusher.Transport=window.WebSocket,Pusher.TransportType="native";var b=(document.location.protocol=="http:"?Pusher.cdn_http:Pusher.cdn_https)+Pusher.VERSION,a=[];window.JSON||a.push(b+"/json2"+Pusher.dependency_suffix+".js");if(!window.WebSocket)window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0,a.push(b+"/flashfallback"+Pusher.dependency_suffix+".js");var d=function(){return window.WebSocket?function(){Pusher.ready()}:function(){window.WebSocket?(Pusher.Transport=window.WebSocket,Pusher.TransportType="flash",window.WEB_SOCKET_SWF_LOCATION=b+"/WebSocketMain.swf",WebSocket.__addTask(function(){Pusher.ready()}),WebSocket.__initialize()):(Pusher.Transport=null,Pusher.TransportType="none",Pusher.ready())}}(),e=function(b){var a=function(){document.body?b():setTimeout(a,0)};a()},c=function(){e(d)};a.length>0?_require(a,c):c()})()